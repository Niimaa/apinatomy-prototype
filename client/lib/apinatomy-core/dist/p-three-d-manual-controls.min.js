!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("jquery"),require("three-js"),require("bluebird"),require("baconjs"),require("tweenjs"),require("bacon.model"),require("bacon.jquery"));else if("function"==typeof define&&define.amd)define(["jquery","three-js","bluebird","baconjs","tweenjs","bacon.model","bacon.jquery"],t);else{var n="object"==typeof exports?t(require("jquery"),require("three-js"),require("bluebird"),require("baconjs"),require("tweenjs"),require("bacon.model"),require("bacon.jquery")):t(e.jQuery,e.THREE,e.P,e.Bacon,e.TWEEN,e["bacon.model"],e["bacon.jquery"]);for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(e,t,n,r,o,a,u){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r,o;r=[n(1),n(3),n(2),n(4)],o=function(e,t,n,r){"use strict";var o=e.circuitboard.plugin({name:"three-d-manual-controls",requires:["three-d"]}),a={LEFT:1,MIDDLE:2,RIGHT:3};o.append("Circuitboard.prototype.construct",function(){var t=this;this.newProperty("threeDManualControlsEnabled",{initial:!0}),this.newEvent("three-d-manual-controls-used"),this.on("threeDMode").value(!0).onValue(function(){var o=!1;t._screen={},t.on("threeDCanvasSize").onValue(function(e){t._screen.width=e.width,t._screen.height=e.height,t._screen.left=parseFloat(t.threeDCanvasElement.css("left")),t._screen.top=parseFloat(t.threeDCanvasElement.css("top"))}),t.getMouseOnScreen=function(e,r){return new n.Vector2((e-t._screen.left)/t._screen.width,(r-t._screen.top)/t._screen.height)},t.threeDCanvasElement.asEventStream("contextmenu").onValue(".preventDefault");var u=t.threeDCanvasElement.mouseDrag({threshold:t.options.dragThreshold}).filter(function(){return t.threeDManualControlsEnabled}),i=e(window).asEventStream("keydown").filter(function(){return t.threeDManualControlsEnabled}),c=e(window).asEventStream("keyup"),s=t.threeDCanvasElement.mouseWheel().filter(function(){return t.threeDManualControlsEnabled}),f=function(e){return function(t){var n=t.mouseDownEvent;return n.which===e}},p=function(e,t){return function(n){return n.which>=e&&n.which<=(t||e)}};t._rotateStart=new n.Vector3,t._rotateEnd=new n.Vector3,u.filter(f(a.LEFT)).onValue(function(e){var n=e,r=n.mouseDownEvent,a=n.mouseMoveEvent;o=!0,r._pastFirst||(r._pastFirst=!0,t._rotateStart.copy(t.getMouseProjectionOnBall(r.pageX,r.pageY))),t._rotateEnd.copy(t.getMouseProjectionOnBall(a.pageX,a.pageY))}),t.newProperty("currentArrowKey",{initial:!1}).addSource(i.filter(p(37,40)).flatMapLatest(function(e){return r.mergeAll([r.once(e.which),c.filter(p(e.which)).map(!1).take(1)])})),t.on("currentArrowKey").onValue(function(){o=!0}),t._zoomStart=new n.Vector2,t._zoomEnd=new n.Vector2,u.filter(f(a.MIDDLE)).onValue(function(e){var n=e,r=n.mouseDownEvent,a=n.mouseMoveEvent;o=!0,r._pastFirst||(r._pastFirst=!0,t._zoomStart.copy(t.getMouseOnScreen(r.pageX,r.pageY))),t._zoomEnd.copy(t.getMouseOnScreen(a.pageX,a.pageY))}),s.onValue(function(e){o=!0,e.preventDefault(),e.stopPropagation(),e=e.originalEvent;var n=0;e.wheelDelta?n=e.wheelDelta/40:e.detail&&(n=-e.detail/3),t._zoomStart.y+=.01*n}),t._panStart=new n.Vector2,t._panEnd=new n.Vector2,u.filter(f(a.RIGHT)).onValue(function(e){var n=e,r=n.mouseDownEvent,a=n.mouseMoveEvent;o=!0,r._pastFirst||(r._pastFirst=!0,t._panStart.copy(t.getMouseOnScreen(r.pageX,r.pageY))),t._panEnd.copy(t.getMouseOnScreen(a.pageX,a.pageY))}),t._eye=new n.Vector3,t._panSpeed=1,t._rotateSpeed=1,t.zoomSpeed=1,t.on("3d-render").takeWhile(t.on("threeDMode")).onValue(function(){(o||t.currentArrowKey)&&(o=!1,t.event("three-d-manual-controls-used").push(),t._eye.subVectors(t.camera3D.position,t.camera3D.userData.target),function(){var e=new n.Vector2,r=new n.Vector3,o=new n.Vector3;e.copy(t._panEnd).sub(t._panStart),e.lengthSq()&&(e.multiplyScalar(t._eye.length()*t._panSpeed),o.copy(t._eye),o.cross(t.camera3D.up),o.setLength(e.x),o.add(r.copy(t.camera3D.up).setLength(e.y)),t.camera3D.position.add(o),t.camera3D.userData.semanticTarget||t.camera3D.userData.target.add(o),t._panStart.copy(t._panEnd))}(),function(){var e=new n.Vector3,r=new n.Quaternion,o=Math.acos(t._rotateStart.dot(t._rotateEnd)/t._rotateStart.length()/t._rotateEnd.length());o&&(e.crossVectors(t._rotateStart,t._rotateEnd).normalize(),o*=t._rotateSpeed,r.setFromAxisAngle(e,-o),t._eye.applyQuaternion(r),t.camera3D.up.applyQuaternion(r),t._rotateEnd.applyQuaternion(r),t._rotateStart.copy(t._rotateEnd))}(),function(){if(t.currentArrowKey){var e=new n.Quaternion,r=new n.Vector3(+(38===t.currentArrowKey||40===t.currentArrowKey),+(37===t.currentArrowKey||39===t.currentArrowKey)),o=.015*Math.PI*t._rotateSpeed;(39===t.currentArrowKey||40===t.currentArrowKey)&&(o*=-1),e.setFromAxisAngle(r,-o),t._eye.applyQuaternion(e),t.camera3D.up.applyQuaternion(e)}}(),function(){var e=1+(t._zoomEnd.y-t._zoomStart.y)*t.zoomSpeed;1!==e&&e>0&&(t._eye.multiplyScalar(e),t._zoomStart.copy(t._zoomEnd))}(),t.camera3D.position.addVectors(t.camera3D.userData.target,t._eye)),t.camera3D.lookAt(t.camera3D.userData.target)})})}),o.add("Circuitboard.prototype.getMouseProjectionOnBall",function(e,t){var r=new n.Vector3,o=new n.Vector3,a=new n.Vector3;a.set((e-.5*this._screen.width-this._screen.left)/(.5*this._screen.width),(.5*this._screen.height+this._screen.top-t)/(.5*this._screen.height),0);var u=a.length();return u>1?a.normalize():a.z=Math.sqrt(1-u*u),this._eye.copy(this.camera3D.position).sub(this.camera3D.userData.target),r.copy(this.camera3D.up).setLength(a.y),r.add(o.copy(this.camera3D.up).cross(this._eye).setLength(a.x)),r.add(this._eye.setLength(a.z)),r})}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(t){t.exports=e},function(e){e.exports=t},function(e,t,n){var r,o;r=[n(5)],o=function(e){"use strict";var t={newClass:function(e){var t=void 0!==arguments[1]?arguments[1]:{};return e.prototype=t,e.prototype.constructor=e,e},newSubclass:function(e,n){var r=void 0!==arguments[2]?arguments[2]:{},o=n(e.prototype.constructor);return o.prototype=Object.create(e.prototype),t.extend(o.prototype,r),o.prototype.constructor=o,o},extend:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e},field:function(e){return function(t){return t[e]}},call:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.apply(void 0,t)},id:function(e){return e},getDef:function(e,n,r){return t.isUndefined(e[n])&&("function"==typeof r&&(r=r()),e[n]=r),e[n]},object:function(e,n){return t.getDef(e,n,{})},array:function(e,n){return t.getDef(e,n,[])},pull:function(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n)},makeEmpty:function(e){for(;e.length>0;)e.pop()},bindA:function(e,t,n){return e.bind.apply(e,[t].concat(n))},bind:function(e,n){for(var r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];return t.bindA(e[n],e,r)},applyConstructor:function(e,t){var n=e.bind.apply(e,[null].concat(t));return new n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},isPlainObject:function(e){return"object"==typeof e&&e.constructor===Object},isFunction:function(e){return"function"==typeof e},objValues:function(e){return Object.keys(e).map(function(t){return e[t]})},makePositioned:function(e){"static"===e.css("position")&&e.css("position","relative")},defOr:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=0;r<e.length;r+=1)if(t.isDefined(e[r]))return e[r]},debounce:function(e,t,n){var r;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=this,i=function(){r=null,e.apply(n||u,o)};clearTimeout(r),r=setTimeout(i,t)}},oncePerStack:function(e,t){var n=!0,r=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];n&&(n=!1,setTimeout(function(){n=!0},0),e.apply(t||this,r))};return r.allowAdditionalCall=function(){n=!0},r},cached:function(e){function n(){var e=o(),t=u;a(e,t)||(u=e,s.forEach(function(n){return n(e,t)}))}var r=e,o=r.retrieve,a=r.isEqual;a=a||function(e,t){return e===t};var u,i=t.oncePerStack(n),c=function(){return i(),u},s=[];return c.onChange=function(e){return s.push(e),c},c.allowAdditionalCall=function(){i.allowAdditionalCall()},i(),c},promisify:function(t,n){return function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return new e(function(e,o){try{t[n].apply(t,r.concat(e))}catch(a){o(a)}})}},findIndex:function(e,t){for(var n=0;n<e.length;++n)if(t(e[n],n,e))return n;return-1},memoize:function(e){var n=[],r=[];return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var u=t.findIndex(n,function(e){return e.every(function(e,t){return e===o[t]})});if(u>=0)return r[u];var i=e.apply(this,o);return n.push(o),r.push(i),i}}},n=1e-6,r=function(e,t){return e>t-n&&t+n>e};return t.Position=t.newClass(function(e,t){this.top=e,this.left=t}),t.Position.subtract=function(e,n){return new t.Position(e.top-n.top,e.left-n.left)},t.Position.equals=function(e,n){return t.isDefined(e)&&t.isDefined(n)&&r(e.top,n.top)&&r(e.left,n.left)},t.Size=t.newClass(function(e,t){this.height=e,this.width=t}),t.Size.equals=function(e,n){return t.isDefined(e)&&t.isDefined(n)&&r(e.height,n.height)&&r(e.width,n.width)},t}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e,t,n){var r,o;r=[n(1),n(3),n(6),n(7)],o=function(e,t,r,o){n(8),n(9),r.fromOnNull=t.memoize(function(e,t){return r.fromBinder(function(n){return e.on(t,function(e){n(new r.Next(e))}),function(){e.on(t,null)}})});var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return r.animationFrames=function(){return r.fromBinder(function(e){var t=!0;return function n(){a(function(){e()===r.noMore&&(t=!1),t&&n()})}(),function(){t=!1}})},r.tween=function(e,t,n){var a=n,u=a.duration,i=a.delay,c=a.easing,s=new o.Tween(e).to(t,u),f=new r.Bus,p=function(){var e=0;return function(t){e+=1,f.plug(t),t.onEnd(function(){e-=1,0===e&&f.end()})}}();return p(r.fromBinder(function(e){c&&s.easing(c),i&&s.delay(i),s.onUpdate(function(){var t=this;e(new r.Next(function(){return t}))}),s.onComplete(function(){e(new r.End)})})),f.tween=s,f.start=function(){return s.start(),f},f.chain=function(e){return p(e),s.chain(e.tween),f},f},r.keyPress=function(t){return e(window).asEventStream("keypress").filter(function(e){return e.keyCode===t})},r.limiter=function(e){var n=void 0!==arguments[1]?arguments[1]:t.call,o=new r.Bus,a=new r.Bus,u=new r.Bus;return e.filter(o.toProperty(!1)).onValue(n,function(){a.push(),o.push(!1),u.push()}),function(e){var t=(void 0!==arguments[1]?arguments[1]:{}).buffer;return o.plug(e.map(!0)),u.startWith(!0).flatMapLatest(function(){var n=function(e,n){return t?e.concat([n]):[n]};return e.takeUntil(a).reduce([],n).flatMap(r.fromArray)})}},r.Observable.prototype.limitedBy=function(e,t){return e(this,t)},r.EventStream.prototype.holdUntil=function(e){var t=this;return r.fromBinder(function(n){var o=[],a=t.onValue(function(e){o.push(new r.Next(function(){return e}))}),u=e.onValue(function(){if(o.length>0){var e=o;o=[],n(e)}});return function(){a(),u(),o=null}})},r.Observable.prototype.value=function(e,t){return t=t||function(t){return t===e},this.skipDuplicates().filter(t)},r.Observable.prototype.run=function(){return this.subscribe(function(){})},r.EventStream.prototype.skipPropagation=function(e){return this.filter(function(n){return!t.array(n.originalEvent,"_onlyOnceFor")[e]}).map(function(n){t.array(n.originalEvent,"_onlyOnceFor")[e]=!0})},r.EventStream.prototype.which=function(e){var t="function"==typeof e?e:function(t){return t===e};return this.filter(function(e){return t(e.which)})},e.fn.mouseDrag=function(){var t=(void 0!==arguments[0]?arguments[0]:{}).threshold;return e(this).asEventStream("mousedown").flatMap(function(n){var r=e(document).asEventStream("mousemove");if(t){var o=!1;r=r.filter(function(e){if(o)return!0;var r=n.pageX-e.pageX,a=n.pageY-e.pageY;return r*r+a*a>t*t?o=!0:!1})}return r.takeUntil(e(document).asEventStream("mouseup")).map(function(e){return{mouseDownEvent:n,mouseMoveEvent:e}})})},e.fn.mouseClick=function(){var t=(void 0!==arguments[0]?arguments[0]:{}).threshold;return e(this).asEventStream("mousedown").flatMap(function(n){var r=e(document).asEventStream("mousemove");if(t){var o=!1;r=r.filter(function(e){if(o)return!0;var r=n.pageX-e.pageX,a=n.pageY-e.pageY;return r*r+a*a>t*t?o=!0:!1})}return e(document).asEventStream("mouseup").take(1).takeUntil(r)})},e.fn.mouseWheel=function(){return e(this).asEventStream("mousewheel DOMMouseScroll")},r}.apply(t,r),!(void 0!==o&&(e.exports=o))},function(e){e.exports=n},function(e){e.exports=r},function(e){e.exports=o},function(e){e.exports=a},function(e){e.exports=u}])});